#!/usr/bin/env bash

CURRENTPATH="$(pwd)"
SCRIPTPATH="$( cd "$(dirname "$0")" ; pwd -P )"
ROOTPATH="$(dirname ${SCRIPTPATH})"
CONFPATH="${ROOTPATH}/config"
RSCPATH="${ROOTPATH}/resources"
BINPATH="${ROOTPATH}/bin"

insert_once() {
  nb_lines=0
  if [ -f "$2" ]; then
    nb_lines=$(grep -F "$1" "$2"|wc -l)
  fi
  if [[ 0 == $nb_lines ]]; then
    echo "$1" >> "$2"
    echo "Pushed config into \"$2\"."
  else
    echo "Config already installed in \"$2\""
  fi
}

insert_once "source ${CONFPATH}/bashrc" ${HOME}/.bashrc
insert_once "source ${CONFPATH}/vimrc.vim" ${HOME}/.vimrc
insert_once "source-file ${CONFPATH}/tmux.conf" ${HOME}/.tmux.conf
insert_once "source ${CONFPATH}/gdbinit" ${HOME}/.gdbinit
git config --global include.path .tools/config/gitconfig

#rsync -qavz "${CONFPATH}/irssi/config" "${HOME}/.irssi/config"
#rsync -qavz "${CONFPATH}/irssi/default.theme" "${HOME}/.irssi/default.theme"
rsync -qavz ${RSCPATH}/vim/.vim ${HOME}/
mkdir -p ${HOME}/projects/go

if [ ! -f "${BINPATH}/cppprompt" ]; then
  mkdir -p "${ROOTPATH}/cppprompt/build"
  cd "${ROOTPATH}/cppprompt/build"
  cmake ../ -DCMAKE_BUILD_TYPE=Release
  make
  mv cppprompt "${BINPATH}/"
  cd "${CURRENTPATH}"
  rm -r "${ROOTPATH}/cppprompt/build"
else
  echo "Cpp prompt exe already installed."
fi

# Install WM confs
if [ ! -f "$HOME/.gtkrc-2.0" ]; then
  cp "${CONFPATH}/.gtkrc-2.0" "$HOME/"
fi
mkdir -p ~/.config/gtk-3.0
if [ ! -f "$HOME/.config/gtk-3.0" ]; then
  cp "${CONFPATH}/gtk-3.0/settings.ini" "$HOME/.config/gtk-3.0/"
fi

mkdir -p ~/.config/i3
if [ ! -L ~/.config/i3/config ]; then
  ln -s "${CONFPATH}/i3/config" ~/.config/i3/
fi
mkdir -p ~/.config/polybar
if [ ! -L ~/.config/polybar/config ]; then
  ln -s "${CONFPATH}/polybar/config" ~/.config/polybar/
  ln -s "${CONFPATH}/polybar/launch.sh" ~/.config/polybar/
fi
if [ ! -f ~/.config/polybar/variables.sh ]; then
  cat >~/.config/polybar/variables.sh <<EOF
POLYBAR_DPI="150"
POLYBAR_HEIGTH="2%"
EOF
fi

